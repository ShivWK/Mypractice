<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <script>

//Callback
        // function loadScript(src, callback) {
        //     let script = document.createElement('script');
        //     script.src = src;

        //     script.onload = () => callback(null, script);
        //     script.onerror = () => callback(new Error("script not loaded"));
        //     document.head.append(script);
        // }

        // loadScript('./script1.js', ()=> {
        //     setTimeout(() => {
        //         console.log("loaded 1");
        //     }, 2000);

        //     loadScript('./script2.js', () => {
        //         setTimeout(() => {
        //             console.log("loaded 2")
        //         }, 2000)

        //         loadScript('./script3.js', () => {
        //             setTimeout(() => {
        //                 console.log("loaded 2")
        //             }, 2000)
        //         })
        //     })
        // })
        
        // loadScript('./script1.js', step1);

        // function step1(error, script) {
        //     if (error) {
        //         console.log(error.message + " in step 1");
        //     } else {
        //         loadScript('./script2.js', step2);
        //     }
        // }

        // function step2(error, script) {
        //     if (error) {
        //         console.log(error.message + " in step 2");
        //     } else {
        //         loadScript('./script3.js', step3);
        //     }
        // }

        // function step3(error, script) {
        //     if (error) {
        //         console.log(error.message + " in step 3");
        //     } else {
        //         console.log("done")
        //     }
        // }

//Promise

        // let promise = new Promise(function(resolve, reject) {
        //     setTimeout(() => {
        //         resolve("Its Done");
        //         reject("failed"); //ignored
        //         resolve("Not failed"); //ignored
        //     })
        // })

        // promise.then(data => {
        //     console.log(data);
        // })

        // promise.then(data => {
        //     console.log(data);
        // }, err => {
        //         console.log(err)
        // })

        // promise.finally(() => {
        //     console.log("cleaned");
        //     // return  "hoo";
        //     throw new Error("Holu hi");
        // })
        
        // promise.catch(err => {
        //     console.log(err);
        // })

//loadScript by promises

        // function loadScript(src) {
        //     return new Promise(function(resolve, reject) {
        //         let script = document.createElement('script');
        //         script.src = src;

        //         script.onload = () => resolve(script);
        //         script.onerror = () => reject(new Error("script load error for "+src));

        //         document.head.append(script);
        //     })
        // }

        // let promise = loadScript('./script1.js');
        // promise.then(() => {
        //     return loadScript('./script2.js')
        // })
        // .then(() => {
        //     return loadScript('./script3.js')
        // })
        // .then(() => {
        //     show1();
        //     show2();
        //     show3();
        // })
        // .catch(err => {
        //     console.error(err.message);
        // })

        // loadScript('./script1.js').then(script => {
        //     loadScript('./script2.js').then(script => {
        //         loadScript('./script3.js').then(() => {
        //             console.log("next question");
        //             show1();
        //             show2();
        //             show3();
        //         })
        //     })
        // })

    //Error handling in promises

        // new Promise((resolve, reject) => {
        //     // throw new Error("new error hun mai");
        //     resolve(2)
        // })
        // .catch(err => {
        //     if (err instanceof URIError) {
        //         console.log(err);
        //     } else {
        //         alert("Can't handle the error");
                
        //         throw err;
        //     }
        // })
        // .then (data => {
        //     console.log(data);
        //     return data; // if i dont return then the further then in the chain will get undefined.
        // })
        // .catch(err => {
        //     alert(err);
        // })
        // .then (data => {
        //     console.log(data);
        // })
    
    //Unhandled rejection

        // new Promise((resolve, reject) => {
        //     reject(new Error("failled"));
        // }) 

        // window.addEventListener('unhandledrejection', (event) => {
        //     console.log(event.promise);
        //     console.log(event.reason);
        // })

    //Promise.resolve, Promise.reject

        // let myMap = new Map();

        // function loadScript(url) {
        //     if (myMap.has(url)) {
        //         return Promise.resolve(myMap.get(url));
        //     }

        //     return fetch(url)
        //             .then(responce => responce.text())
        //             .then(text => {
        //                 myMap.set(url , text);
        //                 return text;
        //             })
        // }

        // loadScript('./script1.js').then(data => console.log(data));

        // function rejectedPromises() {
        //     return Promise.reject(new Error("Failled ji"));
        // }

        // rejectedPromises().then(data => {
        //     console.log(data);
        // })
        // .catch(err => {
        //     console.log(err.message);
        // })

    //async awzit

        // let mine = async function() {
        //     return Promise.resolve(1);
        // }

        // mine().then(data => {
        //     console.log("Hi");
        // })

        async function loadJson(url) {
            let response = await fetch('https://dummyjson.com/products/1');

            if (response.status === 200) {
                let json = await response.json();
                return json;
            }

            throw new Error("not found");
        }

        loadJson('./script1.js')
        .then(data => {
            console.log(data);
        }, err => {
            console.log(err.meassage);
        });
    </script>
</body>
</html>